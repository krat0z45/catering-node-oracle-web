<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Solicitudes de Cancelación - Catering Pro</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simple-grid@2.2/css/simple-grid.css">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: #f4f7f6; margin: 0; }
        .navbar { background-color: #ffffff; padding: 1rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .navbar a { color: #333; text-decoration: none; padding: 0 1rem; font-weight: 500; }
        .container { padding: 2rem; max-width: 900px; margin: auto; }
        .section { background: white; border-radius: 8px; padding: 2rem; box-shadow: 0 2px 5px rgba(0,0,0,0.08); }
        h1 { color: #0056b3; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 0.75rem; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #f2f2f2; }
        td a { text-decoration: none; color: #007bff; font-weight: bold; }
    </style>
</head>
<body>
<div class="navbar"><a href="/index.html">Volver a Inicio</a></div>
<div class="container" id="solicitudes-panel" style="display:none;">
    <h1>Solicitudes de Cancelación Pendientes</h1>
    <div class="section">
        <table id="solicitudes-table">
            <thead><tr><th>ID Proyecto</th><th>Nombre del Proyecto</th><th>Cliente</th><th>Fecha del Evento</th><th>Acción</th></tr></thead>
            <tbody><!-- Se llena dinámicamente --></tbody>
        </table>
    </div>
</div>

<script>
    const user = JSON.parse(sessionStorage.getItem('usuario'));

    document.addEventListener('DOMContentLoaded', () => {
        if (!user || (user.rol !== 'gerente' && user.rol !== 'admin')) {
            document.body.innerHTML = '<h1>Acceso Denegado</h1><p>Debes ser gerente o administrador para ver esta página. <a href="/login.html">Inicia sesión</a></p>';
            return;
        }
        document.getElementById('solicitudes-panel').style.display = 'block';
        loadSolicitudes();
    });

    async function loadSolicitudes() {
        const tbody = document.querySelector('#solicitudes-table tbody');
        try {
            const res = await fetch('/api/proyecto/solicitudes');
            const solicitudes = await res.json();
            tbody.innerHTML = '';
            if (solicitudes.length > 0) {
                solicitudes.forEach(s => {
                    tbody.innerHTML += `
                        <tr>
                            <td>${s.ID_PROYECTO}</td>
                            <td>${s.NOMBRE_PROYECTO}</td>
                            <td>${s.CLIENTE_NOMBRE}</td>
                            <td>${s.FECHA_EVENTO}</td>
                            <td><a href="/detalle-proyecto.html?id=${s.ID_PROYECTO}">Revisar</a></td>
                        </tr>`;
                });
            } else {
                tbody.innerHTML = '<tr><td colspan="5">No hay solicitudes pendientes.</td></tr>';
            }
        } catch (error) {
            console.error('Error cargando solicitudes:', error);
            tbody.innerHTML = '<tr><td colspan="5">Error al cargar los datos.</td></tr>';
        }
    }
</script>
</body>
</html>
