<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Panel de Administración - Catering Pro</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simple-grid@2.2/css/simple-grid.css">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: #f4f7f6; margin: 0; }
        .navbar { /* ... */ }
        .container { padding: 2rem; max-width: 900px; margin: auto; }
        .section { background: white; border-radius: 8px; padding: 2rem; margin-bottom: 2rem; box-shadow: 0 2px 5px rgba(0,0,0,0.08); }
        h1, h2 { color: #0056b3; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 0.75rem; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #f2f2f2; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        input { width: 100%; padding: 0.5rem; }
    </style>
</head>
<body>
<div class="navbar"><a href="/index.html">Volver a Inicio</a></div>
<div class="container" id="admin-panel" style="display:none;">
    <h1>Panel de Administración</h1>

    <div class="section">
        <h2>Lista de Gerentes</h2>
        <table id="gerentes-table">
            <thead><tr><th>ID</th><th>Nombre</th><th>Correo</th><th>Teléfono</th></tr></thead>
            <tbody><!-- Se llena dinámicamente --></tbody>
        </table>
    </div>

    <div class="section">
        <h2>Crear Nuevo Gerente</h2>
        <div class="form-grid">
            <input type="text" id="nombre" placeholder="Nombre Completo">
            <input type="email" id="correo" placeholder="Correo Electrónico">
            <input type="tel" id="telefono" placeholder="Teléfono">
            <input type="password" id="contrasena" placeholder="Contraseña">
        </div>
        <button onclick="crearGerente()" style="margin-top: 1rem;">Crear Gerente</button>
        <p id="msg-crear" style="margin-top: 1rem;"></p>
    </div>
</div>

<script>
    const user = JSON.parse(sessionStorage.getItem('usuario'));

    document.addEventListener('DOMContentLoaded', () => {
        if (!user || user.rol !== 'admin') {
            document.body.innerHTML = '<h1>Acceso Denegado</h1><p>Debes ser administrador para ver esta página. <a href="/login.html">Inicia sesión</a></p>';
            return;
        }
        document.getElementById('admin-panel').style.display = 'block';
        loadGerentes();
    });

    async function loadGerentes() {
        const tbody = document.querySelector('#gerentes-table tbody');
        try {
            const res = await fetch('/api/usuario/gerentes');
            const gerentes = await res.json();
            tbody.innerHTML = '';
            gerentes.forEach(g => {
                tbody.innerHTML += `<tr><td>${g.ID_USUARIO}</td><td>${g.NOMBRE_USUARIO}</td><td>${g.CORREO}</td><td>${g.TELEFONO}</td></tr>`;
            });
        } catch (error) { console.error('Error cargando gerentes:', error); }
    }

    async function crearGerente() {
        const nombre = document.getElementById('nombre').value;
        const correo = document.getElementById('correo').value;
        const telefono = document.getElementById('telefono').value;
        const contrasena = document.getElementById('contrasena').value;
        const msgDiv = document.getElementById('msg-crear');

        try {
            const res = await fetch('/api/usuario/gerentes', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ nombre, correo, telefono, contrasena, id_usuario_accion: user.id })
            });
            const data = await res.json();
            if (res.ok) {
                msgDiv.style.color = 'green';
                msgDiv.textContent = data.message;
                loadGerentes(); // Recargar la lista
                document.querySelectorAll('input').forEach(input => input.value = '');
            } else {
                msgDiv.style.color = 'red';
                msgDiv.textContent = data.error;
            }
        } catch (err) {
             msgDiv.textContent = 'Error de conexión.';
        }
    }
</script>
</body>
</html>
